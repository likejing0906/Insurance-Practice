<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿éšªå¯¦å‹™é›²ç«¯é¡Œåº«</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f9;
        }
        h1 { text-align: center; color: #2c3e50; }
        
        .setup-box {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .question-block {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .question-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #007bff; }
        
        .options label {
            display: block;
            margin: 8px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        .options label:hover { background: #e2e6ea; }

        .result-msg {
            margin-top: 10px; padding: 10px; font-weight: bold; border-radius: 5px; display: none;
        }
        .result-correct { background: #d4edda; color: #155724; }
        .result-wrong { background: #f8d7da; color: #721c24; }

        button#submit-btn {
            width: 100%; padding: 15px; font-size: 18px;
            background: #28a745; color: white; border: none;
            border-radius: 5px; cursor: pointer; margin-top: 20px;
        }
        button#submit-btn:hover { background: #218838; }

        input#sheet-url { width: 100%; padding: 8px; margin-top: 5px; }
    </style>
</head>
<body>

    <h1>â˜ï¸ ä¿éšªå¯¦å‹™é›²ç«¯é¡Œåº«</h1>

    <div class="setup-box" id="setup-area">
        <h3>ğŸ”— è¨­å®šé¡Œåº«ä¾†æº</h3>
        <p>è«‹è²¼ä¸Š Google è©¦ç®—è¡¨ã€Œç™¼å¸ƒåˆ°ç¶²è·¯ã€çš„ CSV é€£çµï¼š</p>
        <input type="text" id="sheet-url" placeholder="https://docs.google.com/spreadsheets/d/.../pub?output=csv">
        <button onclick="loadQuestions()" style="margin-top:10px; padding:5px 15px;">è®€å–é¡Œç›®</button>
        <p style="font-size:12px; margin-top:5px;">* è¨­å®šä¸€æ¬¡å¾Œï¼Œç³»çµ±æœƒè¨˜ä½é€£çµï¼Œä¸‹æ¬¡æ‰“é–‹è‡ªå‹•è®€å–ã€‚</p>
    </div>

    <div id="quiz-area"></div>
    <button id="submit-btn" onclick="checkAnswers()" style="display:none;">äº¤å·å°ç­”æ¡ˆ</button>

    <script>
        let questions = [];

        // é é¢è¼‰å…¥æ™‚å˜—è©¦è®€å–èˆŠé€£çµ
        window.onload = function() {
            const savedUrl = localStorage.getItem('sheet_url');
            if (savedUrl) {
                document.getElementById('sheet-url').value = savedUrl;
                loadQuestions();
            }
        };

        function loadQuestions() {
            const url = document.getElementById('sheet-url').value.trim();
            if (!url) { alert("è«‹è¼¸å…¥ç¶²å€"); return; }

            // ç°¡å–®æª¢æŸ¥ç¶²å€æ ¼å¼
            if (!url.includes("output=csv")) {
                alert("ç¶²å€æ ¼å¼æ€ªæ€ªçš„å–”ï¼è«‹ç¢ºå®šä½ æ˜¯é¸æ“‡ã€Œç™¼å¸ƒåˆ°ç¶²è·¯ã€ä¸¦é¸æ“‡ã€ŒCSVã€æ ¼å¼ã€‚");
            }

            fetch(url)
                .then(response => response.text())
                .then(text => {
                    parseCSV(text);
                    localStorage.setItem('sheet_url', url); // è¨˜ä½ç¶²å€
                    document.getElementById('setup-area').style.display = 'none'; // éš±è—è¨­å®šå€
                    document.getElementById('submit-btn').style.display = 'block';
                })
                .catch(err => {
                    alert("è®€å–å¤±æ•—ï¼è«‹ç¢ºèªç¶²å€æ­£ç¢ºä¸”å·²ç™¼å¸ƒåˆ°ç¶²è·¯ã€‚");
                    console.error(err);
                });
        }

        // è§£æ CSV æ ¼å¼ (è™•ç†é€—è™Ÿåˆ†éš”)
        function parseCSV(text) {
            const rows = text.split('\n').map(row => row.trim()).filter(row => row);
            questions = [];

            // å¾ç¬¬ 1 åˆ—é–‹å§‹ (è·³éæ¨™é¡Œåˆ—ç¬¬ 0 åˆ—)
            for (let i = 1; i < rows.length; i++) {
                // ç°¡æ˜“ CSV åˆ‡å‰² (æ³¨æ„ï¼šè‹¥é¡Œç›®å…§å®¹æœ¬èº«æœ‰é€—è™Ÿå¯èƒ½æœƒåˆ‡éŒ¯ï¼Œå»ºè­°é¡Œç›®å…§å°‘ç”¨å…¨å½¢é€—è™Ÿ)
                // é€™è£¡ä½¿ç”¨æ­£è¦è¡¨é”å¼ä¾†è™•ç†è¼ƒè¤‡é›œçš„ CSV (ä¾‹å¦‚è¢«å¼•è™ŸåŒ…èµ·ä¾†çš„å…§å®¹)
                const cols = parseCSVRow(rows[i]);
                
                if (cols.length >= 6) {
                    questions.push({
                        title: cols[0],
                        options: [cols[1], cols[2], cols[3], cols[4]],
                        answer: parseInt(cols[5])
                    });
                }
            }
            renderQuiz();
        }

        // è™•ç† CSV å–®è¡Œè§£æ (æ”¯æ´å¼•è™Ÿ)
        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuote = false;
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                if (char === '"') { inQuote = !inQuote; }
                else if (char === ',' && !inQuote) {
                    result.push(current.trim());
                    current = '';
                } else { current += char; }
            }
            result.push(current.trim());
            return result;
        }

        function renderQuiz() {
            const area = document.getElementById('quiz-area');
            area.innerHTML = '';
            
            questions.forEach((q, idx) => {
                let opts = '';
                q.options.forEach((opt, i) => {
                    opts += `<label><input type="radio" name="q${idx}" value="${i+1}"> (${i+1}) ${opt}</label>`;
                });

                area.innerHTML += `
                    <div class="question-block">
                        <div class="question-title">${idx+1}. ${q.title}</div>
                        <div class="options">${opts}</div>
                        <div class="result-msg" id="res${idx}"></div>
                    </div>
                `;
            });
            alert(`æˆåŠŸè¼‰å…¥ ${questions.length} é¡Œï¼`);
        }

        function checkAnswers() {
            let correct = 0;
            questions.forEach((q, idx) => {
                const selected = document.querySelector(`input[name="q${idx}"]:checked`);
                const resDiv = document.getElementById(`res${idx}`);
                resDiv.style.display = 'block';
                
                if (!selected) {
                    resDiv.className = 'result-msg result-wrong';
                    resDiv.innerHTML = `âŒ æœªä½œç­” (ç­”æ¡ˆï¼š${q.answer})`;
                } else {
                    if (parseInt(selected.value) === q.answer) {
                        resDiv.className = 'result-msg result-correct';
                        resDiv.innerHTML = 'âœ… ç­”å°äº†';
                        correct++;
                    } else {
                        resDiv.className = 'result-msg result-wrong';
                        resDiv.innerHTML = `âŒ ç­”éŒ¯ (ç­”æ¡ˆï¼š${q.answer} - ${q.options[q.answer-1]})`;
                    }
                }
            });
            alert(`æˆç¸¾ï¼š${correct} / ${questions.length}`);
        }
    </script>
</body>
</html>