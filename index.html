<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿éšªè€ƒè©¦å…¨èƒ½é¡Œåº« - å°ˆæ¥­æ¸¬é©—ç‰ˆ</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f2f5;
        }
        .header-section {
            text-align: center;
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .selector-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .control-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; justify-content: center; }
        select {
            padding: 10px 15px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background: #fff;
        }
        .question-block {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .question-title { font-size: 18px; font-weight: bold; margin-bottom: 12px; color: #1a73e8; line-height: 1.5; }
        .options label {
            display: block;
            margin: 10px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: 0.2s;
        }
        .options label:hover { background: #e8f0fe; }
        .option-correct { background-color: #d4edda !important; border-color: #28a745 !important; font-weight: bold; }
        .option-wrong { background-color: #f8d7da !important; border-color: #dc3545 !important; }
        .result-msg { margin-top: 10px; padding: 12px; font-weight: bold; border-radius: 6px; display: none; }
        .result-correct { background: #d4edda; color: #155724; border-left: 5px solid #28a745; }
        .result-wrong { background: #f8d7da; color: #721c24; border-left: 5px solid #dc3545; }
        #submit-btn {
            width: 100%; padding: 18px; font-size: 20px;
            background: #28a745; color: white; border: none;
            border-radius: 8px; cursor: pointer; margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        #submit-btn:hover { background: #218838; }
        .loading { text-align: center; color: #666; font-style: italic; }
    </style>
</head>
<body>

    <div class="header-section">
        <h1>ğŸ“– ä¿éšªè€ƒè©¦å…¨èƒ½é¡Œåº«</h1>
    </div>

    <div class="selector-box">
        <div class="control-row">
            <strong>é¸æ“‡ç§‘ç›®ï¼š</strong>
            <select id="quiz-selector">
                <option value="">-- è«‹é¸æ“‡ç§‘ç›® --</option>
                <option value="subject1">å£½éšªè€ƒé¡Œ</option>
                <option value="subject2">ç”¢éšªè€ƒé¡Œ</option>
                <option value="subject3">é‡‘èå¸‚å ´è€ƒé¡Œ</option>
                <option value="subject4">è·æ¥­é“å¾·è€ƒé¡Œ</option>
            </select>
        </div>
        <div class="control-row">
            <strong>ç·´ç¿’æ¨¡å¼ï¼š</strong>
            <select id="mode-selector">
                <option value="all">å…¨éƒ¨ç·´ç¿’ (ä¾åº)</option>
                <option value="100">éš¨æ©Ÿ 100 é¡Œ (æ¸¬é©—æ¨¡å¼)</option>
                <option value="50">éš¨æ©Ÿ 50 é¡Œ (å¿«é€Ÿè¤‡ç¿’)</option>
            </select>
            <button onclick="loadSelectedQuiz()" style="padding: 10px 20px; cursor:pointer; background:#1a73e8; color:white; border:none; border-radius:5px;">é–‹å§‹ç·´ç¿’</button>
        </div>
    </div>

    <div id="quiz-area">
        <p class="loading">è«‹é¸æ“‡ç§‘ç›®èˆ‡æ¨¡å¼å¾Œé»æ“Šã€Œé–‹å§‹ç·´ç¿’ã€ã€‚</p>
    </div>
    
    <button id="submit-btn" onclick="checkAnswers()" style="display:none;">äº¤å·å°ç­”æ¡ˆ</button>

    <script>
        const quizSources = {
            "subject1": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQtUmxz2sZwuX6Tg4a7D8i5m6OnxaFFm0wCNe0oAiUFdLV373CAl_wFAfSs9SrzrkKpx9gXtN-_Zf4R/pub?gid=1620305954&single=true&output=csv",
            "subject2": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQtUmxz2sZwuX6Tg4a7D8i5m6OnxaFFm0wCNe0oAiUFdLV373CAl_wFAfSs9SrzrkKpx9gXtN-_Zf4R/pub?gid=188500512&single=true&output=csv",
            "subject3": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQtUmxz2sZwuX6Tg4a7D8i5m6OnxaFFm0wCNe0oAiUFdLV373CAl_wFAfSs9SrzrkKpx9gXtN-_Zf4R/pub?gid=706191201&single=true&output=csv",
            "subject4": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQtUmxz2sZwuX6Tg4a7D8i5m6OnxaFFm0wCNe0oAiUFdLV373CAl_wFAfSs9SrzrkKpx9gXtN-_Zf4R/pub?gid=1853621901&single=true&output=csv"
        };

        let currentQuestions = [];

        function loadSelectedQuiz() {
            const subjectKey = document.getElementById('quiz-selector').value;
            const mode = document.getElementById('mode-selector').value;
            const quizArea = document.getElementById('quiz-area');
            const submitBtn = document.getElementById('submit-btn');

            if (!subjectKey) { alert("è«‹å…ˆé¸æ“‡ç§‘ç›®ï¼"); return; }

            const url = quizSources[subjectKey];
            quizArea.innerHTML = '<p class="loading">æ­£åœ¨å¾é›²ç«¯æŠ“å–é¡Œç›®...</p>';
            submitBtn.style.display = 'none';

            fetch(url)
                .then(res => res.text())
                .then(text => {
                    processQuestions(text, mode);
                    submitBtn.style.display = 'block';
                    window.scrollTo(0, document.querySelector('.selector-box').offsetTop + 150);
                })
                .catch(err => {
                    quizArea.innerHTML = '<p style="color:red;">è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèªç¶²è·¯é€£ç·šæˆ– CSV ç¶²å€ã€‚</p>';
                });
        }

        function processQuestions(csvText, mode) {
            const rows = csvText.split('\n').map(r => r.trim()).filter(r => r);
            let allFetched = [];
            
            for (let i = 1; i < rows.length; i++) {
                const cols = parseCSVRow(rows[i]);
                if (cols.length >= 6) {
                    allFetched.push({
                        title: cols[0],
                        options: [cols[1], cols[2], cols[3], cols[4]],
                        answer: parseInt(cols[5])
                    });
                }
            }

            // è™•ç†æ¨¡å¼
            if (mode === "100" || mode === "50") {
                const limit = parseInt(mode);
                allFetched = allFetched.sort(() => Math.random() - 0.5).slice(0, limit);
            }

            currentQuestions = allFetched;
            renderQuiz();
        }

        function renderQuiz() {
            const area = document.getElementById('quiz-area');
            area.innerHTML = '';
            currentQuestions.forEach((q, idx) => {
                let optsHtml = '';
                q.options.forEach((opt, i) => {
                    optsHtml += `<label id="q${idx}-opt${i+1}"><input type="radio" name="q${idx}" value="${i+1}"> (${i+1}) ${opt}</label>`;
                });
                area.innerHTML += `
                    <div class="question-block">
                        <div class="question-title">${idx+1}. ${q.title}</div>
                        <div class="options">${optsHtml}</div>
                        <div class="result-msg" id="res${idx}"></div>
                    </div>
                `;
            });
        }

        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuote = false;
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                if (char === '"') inQuote = !inQuote;
                else if (char === ',' && !inQuote) {
                    result.push(current.trim());
                    current = '';
                } else current += char;
            }
            result.push(current.trim());
            return result;
        }

        function checkAnswers() {
            let score = 0;
            currentQuestions.forEach((q, idx) => {
                const selected = document.querySelector(`input[name="q${idx}"]:checked`);
                const resDiv = document.getElementById(`res${idx}`);
                const correctLabel = document.getElementById(`q${idx}-opt${q.answer}`);
                
                for(let i=1; i<=4; i++) {
                    const lbl = document.getElementById(`q${idx}-opt${i}`);
                    if(lbl) lbl.className = '';
                }

                resDiv.style.display = 'block';
                
                if (!selected) {
                    resDiv.className = 'result-msg result-wrong';
                    resDiv.innerHTML = `âŒ æœªä½œç­” (æ­£ç¢ºç­”æ¡ˆï¼š(${q.answer}) ${q.options[q.answer-1]})`;
                    correctLabel.className = 'option-correct';
                } else {
                    const userVal = parseInt(selected.value);
                    if (userVal === q.answer) {
                        resDiv.className = 'result-msg result-correct';
                        resDiv.innerHTML = 'âœ… ç­”å°äº†ï¼';
                        correctLabel.className = 'option-correct';
                        score++;
                    } else {
                        const wrongLabel = document.getElementById(`q${idx}-opt${userVal}`);
                        resDiv.className = 'result-msg result-wrong';
                        resDiv.innerHTML = `âŒ ç­”éŒ¯äº† (æ­£ç¢ºç­”æ¡ˆï¼š(${q.answer}) ${q.options[q.answer-1]})`;
                        correctLabel.className = 'option-correct';
                        wrongLabel.className = 'option-wrong';
                    }
                }
            });
            window.scrollTo(0, 0);
            alert(`æ¸¬é©—çµæŸï¼\nç­”å°ï¼š${score} / ${currentQuestions.length}\nå¾—åˆ†ï¼š${Math.round(score/currentQuestions.length*100)} åˆ†`);
        }
    </script>
</body>
</html>
